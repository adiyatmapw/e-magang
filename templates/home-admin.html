<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Home Admin - E-Magang</title>

    <!-- CSS Bootstrap & Google Font -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;600&display=swap" rel="stylesheet" />

    <style>
        body {
            font-family: 'Figtree', sans-serif;
            background-color: #f8f9fc;
            margin-bottom: 2rem;
        }

        .header-image {
            background: url('{{ url_for('static', filename='images/header3.png') }}') center center / cover no-repeat;
            background-size: 100%;
            height: 200px;
            max-width: 100%;
            opacity: 0.8;
            border-radius: 10px;
            margin-bottom: 30px;
            position: relative;
        }

        .header-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.32), rgba(255, 255, 255, 0.811));
        }

        .overview-sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-left: auto;
            margin-top: 20px;
        }

        .overview-item {
            border-radius: 12px;
            padding: 16px 20px;
            color: white;
            font-weight: 600;
            text-align: left;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .item-blue {
            background-color: #1D4ED8;
        }

        .item-green {
            background-color: #059669;
        }

        .item-gray {
            background-color: #6B7280;
        }

        .item-yellow {
            background-color: #facc15;
            color: black;
        }

        .item-orange {
            background-color: #fb923c;
        }

        .item-purple {
            background-color: #8b5cf6;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 0 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .copyright {
            text-align: center;
            margin-top: 50px;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>

<body>

    {% include 'navbar-admin.html' %}
    {% include 'partials/flash_message.html' %}

    <div class="container-fluid">
        <div class="header-image">
            <div class="header-overlay"></div>
        </div>
    </div>

    <div class="container">
        <h4 class="mb-3">Selamat Datang, Admin!</h4>
        <div class="row">
            
            <!-- KIRI: Chart -->
            <div class="col-md-8">

            <!-- Grafik Bar Gender dengan Filter -->
            <div class="chart-card">
                <div class="justify-content-between align-items-center mb-3">
                    <h5 class="mb-3">Filter Data</h5>
                    <div class="d-flex gap-2">
                        <input type="date" id="startDate" class="form-control form-control-sm" />
                        <input type="date" id="endDate" class="form-control form-control-sm" />
                        <button class="btn btn-sm btn-primary" onclick="filterJurusan()">Filter</button>
                    </div>
                </div>
            </div>
            <div class="chart-card" style="max-height: 500px; overflow-y: auto;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="mb-0">Distribusi Peserta Berdasarkan Jurusan</h5>
                    <div class="d-flex gap-2">
                    </div>
                </div>
                <div style="overflow-y: auto;">
                    <canvas id="jurusanChart"></canvas>
                </div>
            </div>


                <!-- Grafik Jumlah Pendaftar -->
                <div class="chart-card">
                    <h5 class="mb-3">Jumlah Pendaftar Setiap Bulan</h5>
                    <canvas id="monthlyChart"></canvas>
                </div>

                <!-- Grafik Pie Chart Divisi -->
                <div class="chart-card">
                    <h5 class="mb-3">Distribusi Peserta Berdasarkan Divisi</h5>
                    <div style="max-width: 300px; margin: 0 auto;">
                        <canvas id="divisiChart"></canvas>
                    </div>
                </div>
  

            </div>

            <!-- KANAN: Overview Summary -->
            <div class="col-md-4">
                <div class="overview-sidebar">
                    <div class="overview-item item-blue">
                        Magang Sedang Berlangsung<br><span style="font-size: 22px;">{{ sedang_magang }}</span>
                    </div>
                    <div class="overview-item item-green">
                        Cetak Sertifikat<br><span style="font-size: 22px;">{{ cetak_sertifikat }}</span>
                    </div>
                    <div class="overview-item item-gray">
                        Ditolak<br><span style="font-size: 22px;">{{ total_ditolak }}</span>
                    </div>
                </div>

                <div class="overview-sidebar mt-4">
                    <div class="overview-item item-yellow">
                        Wawancara<br><span style="font-size: 22px;">{{ wawancara }}</span>
                    </div>
                    <div class="overview-item item-orange">
                        Proses Seleksi<br><span style="font-size: 22px;">{{ proses_seleksi }}</span>
                    </div>
                    <div class="overview-item item-purple">
                        Kelengkapan Berkas<br><span style="font-size: 22px;">{{ kelengkapan_berkas }}</span>
                    </div>
                    <div class="overview-item item-blue">
                        Pendaftar<br><span style="font-size: 22px;">{{ total_pendaftar }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="copyright">
        Copyright Â© 2025 e-Magang. All rights reserved.
    </div>

    <!-- JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const jurusanLabels = [
            'Teknik Mesin', 'Teknik Elektro', 'Teknik Sipil', 'Teknik Industri',
            'Teknik Informatika', 'Teknik Kimia', 'Teknik Otomotif', 'Teknik Perminyakan',
            'Teknik Fisika', 'Teknik Lingkungan', 'Teknik Penerbangan', 'Teknik Perkapalan',
            'Teknik Telekomunikasi', 'Teknik Material', 'Manajemen', 'Akuntansi',
            'Ilmu Komputer', 'Sistem Informasi', 'Fisika', 'Matematika', 'Statistika',
            'Kimia', 'Biologi', 'Geografi', 'Hubungan Internasional', 'Ilmu Hukum',
            'Administrasi Negara', 'Psikologi', 'Ilmu Komunikasi', 'Desain Produk',
            'Desain Komunikasi Visual', 'Seni Rupa', 'Teknologi Pangan', 'Agroteknologi',
            'Peternakan', 'Kehutanan', 'Perikanan', 'Teknik Energi Terbarukan', 'Teknik Robotika'
        ];

        const originalData = Array.from({
            length: jurusanLabels.length
        }, () => Math.floor(Math.random() * 20 + 5));

        const ctxJurusan = document.getElementById('jurusanChart').getContext('2d');
        const jurusanChart = new Chart(ctxJurusan, {
            type: 'bar',
            data: {
                labels: jurusanLabels,
                datasets: [{
                    label: 'Jumlah Peserta',
                    data: [...originalData],
                    backgroundColor: 'rgba(99, 102, 241, 0.7)'
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: true
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `${ctx.parsed.x} Peserta`
                        }
                    },
                    legend: {
                        display: false
                    }
                }
            }
        });

        function filterJurusan() {
            const start = document.getElementById("startDate").value;
            const end = document.getElementById("endDate").value;

            if (!start || !end) {
                alert("Pilih rentang tanggal terlebih dahulu.");
                return;
            }

            // Dummy filter logic: regenerate random values
            jurusanChart.data.datasets[0].data = Array.from({
                length: jurusanLabels.length
            }, () => Math.floor(Math.random() * 20 + 5));
            jurusanChart.update();
        }
    </script>
    <script>
        document.getElementById('jurusanChart').parentElement.style.height = `${jurusanLabels.length * 30}px`;
    </script>

    <script>
        // Dummy: Jumlah Pendaftar Setiap Bulan
        const ctxMonthly = document.getElementById('monthlyChart').getContext('2d');
        const monthlyChart = new Chart(ctxMonthly, {
        type: 'bar',
        data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt'],
        datasets: [
        {
        label: 'Pendaftar',
        data: [30, 35, 44, 33, 43, 40, 55, 42, 36, 48],
        backgroundColor: 'rgba(96, 165, 250, 0.2)',
        borderRadius: 5
        },
        {
        label: 'Tren',
        data: [30, 35, 44, 33, 43, 40, 55, 42, 36, 48],
        type: 'line',
        borderColor: '#3b82f6',
        borderWidth: 2,
        pointRadius: 0,
        fill: false
        }
        ]
        },
        options: {
        responsive: true,
        plugins: {
        tooltip: {
        callbacks: {
        label: (ctx) => `${ctx.parsed.y} Pendaftar`
        }
        }
        },
        scales: {
        y: {
        beginAtZero: true
        }
        }
        }
        });
    </script>
    <script>
    // Dummy: Distribusi Peserta Berdasarkan Divisi
    const ctxDivisi = document.getElementById('divisiChart').getContext('2d');
    const divisiChart = new Chart(ctxDivisi, {
    type: 'pie',
    data: {
    labels: ['Divisi Alat Berat', 'Divisi Kendaraan Khusus', 'Divisi Infrastruktur Perhubungan', 'Divisi Manajerial Pengelolaan'],
    datasets: [{
    data: [30, 25, 20, 25],
    backgroundColor: ['#3b82f6', '#ec4899', '#10b981', '#f59e0b'],
    borderWidth: 1
    }]
    },
    options: {
    responsive: true,
    plugins: {
    legend: {
    position: 'bottom'
    },
    tooltip: {
    callbacks: {
    label: (ctx) => `${ctx.label}: ${ctx.raw}%`
    }
    }
    }
    }
    });

    </script>

</body>

</html>
