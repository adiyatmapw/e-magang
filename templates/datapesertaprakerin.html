<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Data Peserta Magang</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Figtree:wght@400;600&display=swap" rel="stylesheet" />
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Figtree', sans-serif;
      margin-bottom: 2rem;
    }
    .header-image {
        background: url('{{ url_for('static', filename='images/header3.png') }}') center center / cover no-repeat;
        background-size: 100%;
        height: 200px;
        max-width: 100%;
        opacity: 0.8;
        border-radius: 10px;
        margin-bottom: 30px;
        position: relative;
    }
    .filter-card {
      margin-bottom: 1.5rem;
    }
    .btn-filter {
      border-radius: 25px;
    }
    .dataTables_wrapper .dataTables_filter {
      display: none;
    }
    thead th {
        text-align: center;
        vertical-align: middle;
    }
    #tabel-aktif thead th {
        text-align: center !important;
        vertical-align: middle !important;
    }
    #tabel-selesai thead th {
        text-align: center !important;
        vertical-align: middle !important;
    }
    .table thead th {
        vertical-align: middle;
        text-align: center;
    }
    .table tbody td {
        vertical-align: middle;
        text-align: center;
    }
    .copyright {
        margin-top: 50px;
        text-align: center;
        font-size: 14px;
        color: #666;
    }
    .filter-header {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .filter-header .label {
        font-family: 'Figtree', sans-serif;
        font-weight: 600;
        margin-bottom: 4px;
    }
    .status-tag {
        padding: 5px 10px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: bold;
        color: white;
        white-space: nowrap;
        max-width: 140px;
        overflow: hidden;
        text-overflow: ellipsis;
        display: inline-block;
    }

    .status-selesai { background-color: #14ce3f; }
    .status-masih { background-color: #1026cf; }
    .status-ditolak { background-color: #dc3545; }



  </style>
</head>
<body>
  {% include 'navbar-admin.html' %}
{% include 'partials/flash_message.html' %}
  <div class="container-fluid">
    <div class="header-image"></div>
</div>

    <div class="container">
    <h4>Data Peserta Magang</h4>

    <div class="card filter-card">
      <div class="card-header bg-secondary text-white" data-bs-toggle="collapse" data-bs-target="#filterPanel" style="cursor: pointer;">
        Filter Data <span class="float-end"><i class="bi bi-chevron-down"></i></span>
      </div>
      <div id="filterPanel" class="collapse card-body bg-light">
        <form id="filterForm" class="row g-3">
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Nama</label>
            <input type="text" class="form-control" name="nama" />
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Email</label>
            <input type="text" class="form-control" name="email" />
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Asal Kampus</label>
            <input type="text" class="form-control" name="kampus" />
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Divisi</label>
            <input type="text" class="form-control" name="nama_divisi" />
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Status Laporan</label>
            <select class="form-select" name="status_laporan">
              <option value="">Semua</option>
              <option value="Magang Sedang Berlangsung">Magang Sedang Berlangsung</option>
              <option value="Magang Selesai">Magang Selesai</option>
              <option value="Ditolak">Ditolak</option>
            </select>
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Tanggal Daftar (Dari)</label>
            <input type="date" class="form-control" name="tanggal_daftar_from" />
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Tanggal Daftar (Sampai)</label>
            <input type="date" class="form-control" name="tanggal_daftar_to" />
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Tanggal Magang Dimulai (Dari)</label>
            <input type="date" class="form-control" name="tanggal_magang_dimulai_from" />
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Tanggal Magang Dimulai (Sampai)</label>
            <input type="date" class="form-control" name="tanggal_magang_dimulai_to" />
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Tanggal Magang Selesai (Dari)</label>
            <input type="date" class="form-control" name="tanggal_magang_selesai_from" />
          </div>
          <div class="col-md-6 col-lg-3">
            <label class="form-label">Tanggal Magang Selesai (Sampai)</label>
            <input type="date" class="form-control" name="tanggal_magang_selesai_to" />
          </div>

          <div class="col-12">
            <button type="submit" class="btn btn-primary btn-filter">Filter</button>
          </div>
        </form>
      </div>
    </div>

    
    <h5>Data Peserta Aktif</h5>
    <div class="d-flex justify-content-end mb-2">
      <button class="btn btn-success" onclick="exportToExcel('tabel-peserta', 'DataPesertaAktif')">
        <i class="bi bi-download me-1"></i> Export Excel Peserta Aktif
      </button>
    </div>
    
    <table id="tabel-peserta" class="table table-striped table-bordered table-hover" style="width:100%">
      <thead>
        <tr>
          <th>No</th>
          <th>Nama</th>
          <th>Email</th>
          <th>Asal Kampus</th>
          <th>Divisi</th>
          <th>Status Laporan</th>
          <th>Tanggal Daftar</th>
          <th>Tanggal Magang Dimulai</th>
          <th>Tanggal Magang Selesai</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for p in data_peserta %}
        <tr>
          <td class="text-center">{{ loop.index }}</td>
          <td>{{ p['data'].nama }}</td>
          <td>{{ p['data'].email }}</td>
          <td>{{ p['data'].asal_kampus }}</td>
          <td>{{ p['data'].nama_divisi or '-' }}</td>
          <td>
            {% if p['data'].status_laporan_magang == 'Sertifikat Tercetak' %}
            <span class="status-tag status-selesai" data-bs-toggle="tooltip" title="Sudah Selesai">Magang
              Sudah Selesai</span>
            {% else %}
            <span class="status-tag status-masih" data-bs-toggle="tooltip" title="Magang Sedang Berlangsung">
              Magang Sedang Berlangsung
            </span>
            {% endif %}
          </td>
          <td data-order="{{ p['tanggal_daftar'].strftime('%Y-%m-%d') }}">{{ p['tanggal_daftar'].strftime('%d-%m-%Y') }}
          </td>
          <td data-order="{{ p['tanggal_mulai'].strftime('%Y-%m-%d') }}">{{ p['tanggal_mulai'].strftime('%d-%m-%Y') }}
          </td>
          <td data-order="{{ p['tanggal_selesai'].strftime('%Y-%m-%d') }}">
            {{ p['tanggal_selesai'].strftime('%d-%m-%Y') }}</td>
          

          <td class="text-center">
            <a href="{{ url_for('detailpesertaprakerin', id=p['data'].id) }}" class="btn btn-warning btn-sm"><i
              class="bi bi-eye"></i></a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      <h5 class="mt-5">Arsip Peserta (Ditolak & Magang Selesai)</h5>
      
      <div class="d-flex justify-content-end mb-4">
        <button class="btn btn-success" onclick="exportToExcel('tabel-arsip', 'DataPesertaArsip')">
          <i class="bi bi-download me-1"></i> Export Excel Arsip Peserta
        </button>
      </div>
      <table id="tabel-arsip" class="table table-striped table-bordered table-hover" style="width:100%">
        <thead>
          <tr>
            <th>No</th>
            <th>Nama</th>
            <th>Email</th>
            <th>Asal Kampus</th>
            <th>Divisi</th>
            <th>Status</th>
            <th>Tanggal Daftar</th>
            <th>Tanggal Magang Dimulai</th>
            <th>Tanggal Magang Selesai</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for p in data_arsip %}
        <tr>
          <td class="text-center">{{ loop.index }}</td>
          <td>{{ p['data'].nama }}</td>
          <td>{{ p['data'].email }}</td>
          <td>{{ p['data'].asal_kampus }}</td>
          <td>{{ p['data'].nama_divisi or '-' }}</td>
          <td>
            {% if p['data'].status_daftar == 'Ditolak' %}
            <span class="status-tag status-ditolak" data-bs-toggle="tooltip"
              title="Ditolak">Ditolak</span>
            {% else %}
            <span class="status-tag status-selesai" data-bs-toggle="tooltip" title="Magang Selesai">Magang
              Selesai</span>
            {% endif %}
          </td>
          <td data-order="{{ p['tanggal_daftar'].strftime('%Y-%m-%d') }}">
            {{ p['tanggal_daftar'].strftime('%d-%m-%Y') }}
          </td>
          <td data-order="{{ p['tanggal_mulai'].strftime('%Y-%m-%d') }}">
            {{ p['tanggal_mulai'].strftime('%d-%m-%Y') }}
          </td>
          <td data-order="{{ p['tanggal_selesai'].strftime('%Y-%m-%d') }}">
            {{ p['tanggal_selesai'].strftime('%d-%m-%Y') }}</td>
          <td class="text-center">
            <a href="{{ url_for('detailpesertaprakerin', id=p['data'].id) }}" class="btn btn-warning btn-sm"><i
                class="bi bi-eye"></i></a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

  <script>
    $(document).ready(function () {
      const table = $('#tabel-peserta').DataTable({
        paging: true,
        searching: true,
        lengthChange: true,
        order: [[0, 'asc']],
        columnDefs: [
          { orderable: false, targets: [6] }  // Disable ordering on Action
        ]
      });

      $('#filterForm').on('submit', function (e) {
        e.preventDefault();

        const nama = $('input[name="nama"]').val();
        const email = $('input[name="email"]').val();
        const kampus = $('input[name="kampus"]').val();
        const divisi = $('input[name="nama_divisi"]').val();
        const status_laporan = $('select[name="status_laporan"]').val();

        table
          .column(1).search(nama)
          .column(2).search(email)
          .column(3).search(kampus)
          .column(4).search(divisi)
          .column(5).search(status_laporan)
          .draw();

          // Tambahan filter tanggal dummy
          const daftarFrom = $('input[name="tanggal_daftar_from"]').val();
          const daftarTo = $('input[name="tanggal_daftar_to"]').val();
          const mulaiFrom = $('input[name="tanggal_mulai_from"]').val();
          const mulaiTo = $('input[name="tanggal_mulai_to"]').val();
          const selesaiFrom = $('input[name="tanggal_selesai_from"]').val();
          const selesaiTo = $('input[name="tanggal_selesai_to"]').val();

          table.rows().every(function () {
          const row = $(this.node());
          const tglDaftar = row.find('td:eq(6)').data('order'); // kolom ke-6
          const tglMulai = row.find('td:eq(7)').data('order'); // kolom ke-7
          const tglSelesai = row.find('td:eq(8)').data('order'); // kolom ke-8

          let show = true;

          if (daftarFrom && tglDaftar < daftarFrom) show=false; if (daftarTo && tglDaftar> daftarTo) show = false;

            if (mulaiFrom && tglMulai < mulaiFrom) show=false; if (mulaiTo && tglMulai> mulaiTo) show = false;

              if (selesaiFrom && tglSelesai < selesaiFrom) show=false; if (selesaiTo && tglSelesai> selesaiTo) show =
                false;

                row.toggle(show);
      });
    });
  });
  </script>
  <script>
    $(document).ready(function () {
      $('#tabel-arsip').DataTable({
        paging: true,
        searching: true,
        lengthChange: true,
        order: [
          [0, 'asc']
        ]
      });
    });
  </script>
  <script>
    function exportToExcel(tableId, filename = '') {
      const table = document.getElementById(tableId);
      const wb = XLSX.utils.table_to_book(table, {
        sheet: "Sheet1"
      });
      XLSX.writeFile(wb, filename + ".xlsx");
    }
  </script>
  <script>
    document.querySelectorAll('[data-bs-toggle="tooltip"]').forEach(function (tooltipTriggerEl) {
    new bootstrap.Tooltip(tooltipTriggerEl);
    });
  </script>
  
  
</body>
</html>
